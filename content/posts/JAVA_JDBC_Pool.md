---
title: " 数据库连接池 "
date: 2017-12-07
draft: false
author: Small Fire
isCJKLanguage: true
categories: 
  - JAVA

tags: 
  - MySQL
---

### 数据库连接池的应用

每次访问数据库都会创建一个连接，初始化连接，关闭连接，会执行访问数据库的所有操作，由于每次创建初始化连接和关闭连接会花费大量的时间，会导致整个程序效率低下，因此为解决在访问数据库时要不断的初始化连接和关闭连接带来的时间消耗问题，我们采取了连接池的方式。

#### 连接池优点

资源重用

- 由于数据库连接得以重用，避免了频繁创建，释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。

提升系统执行效率

- 数据库连接池在初始化过程中，已经创建了一定的数据库连接置于连接池中，此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间。

新的资源分配手段

- 对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接池的配置，实现某一应用最大可用数据库连接数的限制，避免某一应用独占所有的数据库资源。

统一的连接管理，避免数据库连接泄露

- 在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露。

### 连接池工作原理

JDBC 的数据库连接池使用 javax.sql.DataSource 来表示，DataSource 只是一个接口，用来进行规范约束访问数据库的流程。该接口通常由服务器(Weblogic, WebSphere, Tomcat)提供实现。

- DataSource 通常被称为数据源，它包含连接池和连接池管理两个部分

#### 连接池的建立

在系统初始化时，连接池会根据系统配置建立，并在池中创建了几个连接对象，以便使用时能从连接池中获取。连接池中的连接不能随意创建和关闭，这样避免了连接随意建立和关闭造成的系统开销。

#### 连接池中连接的使用管理

连接池管理策略是连接池机制的核心，连接池内连接的分配和释放对系统的性能有很大的影响。

当客户请求数据库连接时，首先查看连接池中是否有空闲连接，如果存在空闲连接，则将连接分配给客户使用；如果没有空闲连接，则查看当前所开的连接数是否已经达到最大连接数，如果没达到就重新创建一个连接给请求的客户；如果达到就按设定的最大等待时间进行等待，如果超出最大等待时间，则抛出异常给客户。

当客户释放数据库连接时，先判断该连接的引用次数是否超过了规定值，如果超过就从连接池中删除该连接，否则保留为其他客户服务。

该策略保证了数据库连接的有效复用，避免频繁的建立、释放连接所带来的系统资源开销。

#### 连接池的关闭

当应用程序退出时，关闭连接池中所有的连接，释放连接池相关的资源，该过程正好与创建相反。

#### 连接池主要参数

| 参数             | 描述                                                         |
| :--------------- | :----------------------------------------------------------- |
| 最小连接数       | 连接池一直保持的数据库连接                                   |
| 最大连接数       | 连接池能申请的最大连接数,如果数据库连接请求超过次数,后面的数据库连接请求将被加入到等待队列中 |
| 最大空闲时间     |                                                              |
| 获取连接超时时间 |                                                              |
| 超时重试连接次数 |                                                              |

### Druid 连接池

 Druid 是类似 dbcp，c3p0 的一个数据库连接池框架，性能比这两者好，同时自带监控页面，可以实时监控应用的连接池情况以及其中性能差的 sql，方便我们找出应用中连接池方面的问题。

#### 使用 Druid

 [下载 druid jar包](https://repo1.maven.org/maven2/com/alibaba/druid/)，